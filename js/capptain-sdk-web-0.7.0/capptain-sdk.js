(function(){if(!window.capptain)window.capptain={};var t=capptain.Crypto={},v=t.util={rotl:function(j,n){return j<<n|j>>>32-n},rotr:function(j,n){return j<<32-n|j>>>n},endian:function(j){if(j.constructor==Number)return v.rotl(j,8)&16711935|v.rotl(j,24)&4278255360;for(var n=0;n<j.length;n++)j[n]=v.endian(j[n]);return j},randomBytes:function(j){for(var n=[];j>0;j--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(j){for(var n=[],m=0,q=0;m<j.length;m++,q+=8)n[q>>>5]|=j[m]<<24-q%
32;return n},wordsToBytes:function(j){for(var n=[],m=0;m<j.length*32;m+=8)n.push(j[m>>>5]>>>24-m%32&255);return n},bytesToHex:function(j){for(var n=[],m=0;m<j.length;m++){n.push((j[m]>>>4).toString(16));n.push((j[m]&15).toString(16))}return n.join("")},hexToBytes:function(j){for(var n=[],m=0;m<j.length;m+=2)n.push(parseInt(j.substr(m,2),16));return n},bytesToBase64:function(j){if(typeof btoa=="function")return btoa(p.bytesToString(j));for(var n=[],m=0;m<j.length;m+=3)for(var q=j[m]<<16|j[m+1]<<8|
j[m+2],d=0;d<4;d++)m*8+d*6<=j.length*8?n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6*(3-d)&63)):n.push("=");return n.join("")},base64ToBytes:function(j){if(typeof atob=="function")return p.stringToBytes(atob(j));j=j.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],m=0,q=0;m<j.length;q=++m%4)q!=0&&n.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(j.charAt(m-1))&Math.pow(2,-2*q+8)-1)<<q*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(j.charAt(m))>>>
6-q*2);return n}};t.mode={};t=t.charenc={};t.UTF8={stringToBytes:function(j){return p.stringToBytes(unescape(encodeURIComponent(j)))},bytesToString:function(j){return decodeURIComponent(escape(p.bytesToString(j)))}};var p=t.Binary={stringToBytes:function(j){for(var n=[],m=0;m<j.length;m++)n.push(j.charCodeAt(m));return n},bytesToString:function(j){for(var n=[],m=0;m<j.length;m++)n.push(String.fromCharCode(j[m]));return n.join("")}}})();(function(){var t=capptain.Crypto,v=t.util,p=t.charenc,j=p.UTF8,n=p.Binary;t.HMAC=function(m,q,d,a){if(q.constructor==String)q=j.stringToBytes(q);if(d.constructor==String)d=j.stringToBytes(d);if(d.length>m._blocksize*4)d=m(d,{asBytes:true});var b=d.slice(0);d=d.slice(0);for(var g=0;g<m._blocksize*4;g++){b[g]^=92;d[g]^=54}m=m(b.concat(m(d.concat(q),{asBytes:true})),{asBytes:true});return a&&a.asBytes?m:a&&a.asString?n.bytesToString(m):v.bytesToHex(m)}})();(function(){var t=capptain.Crypto,v=t.util,p=t.charenc,j=p.UTF8,n=p.Binary,m=t.SHA1=function(q,d){var a=v.wordsToBytes(m._sha1(q));return d&&d.asBytes?a:d&&d.asString?n.bytesToString(a):v.bytesToHex(a)};m._sha1=function(q){if(q.constructor==String)q=j.stringToBytes(q);var d=v.bytesToWords(q),a=q.length*8;q=[];var b=1732584193,g=-271733879,e=-1732584194,h=271733878,c=-1009589776;d[a>>5]|=128<<24-a%32;d[(a+64>>>9<<4)+15]=a;for(a=0;a<d.length;a+=16){for(var f=b,i=g,l=e,u=h,y=c,x=0;x<80;x++){if(x<16)q[x]=
d[a+x];else{var A=q[x-3]^q[x-8]^q[x-14]^q[x-16];q[x]=A<<1|A>>>31}A=(b<<5|b>>>27)+c+(q[x]>>>0)+(x<20?(g&e|~g&h)+1518500249:x<40?(g^e^h)+1859775393:x<60?(g&e|g&h|e&h)-1894007588:(g^e^h)-899497514);c=h;h=e;e=g<<30|g>>>2;g=b;b=A}b+=f;g+=i;e+=l;h+=u;c+=y}return[b,g,e,h,c]};m._blocksize=16})();capptain.MD5=function(){var t=function(e,h){var c=(e&65535)+(h&65535);return(e>>16)+(h>>16)+(c>>16)<<16|c&65535},v=function(e){for(var h=[],c=0;c<e.length*8;c+=8)h[c>>5]|=(e.charCodeAt(c/8)&255)<<c%32;return h},p=function(e){for(var h="",c=0;c<e.length*32;c+=8)h+=String.fromCharCode(e[c>>5]>>>c%32&255);return h},j=function(e){for(var h="",c=0;c<e.length*4;c++)h+="0123456789abcdef".charAt(e[c>>2]>>c%4*8+4&15)+"0123456789abcdef".charAt(e[c>>2]>>c%4*8&15);return h},n=function(e){for(var h="",c,f,i=0;i<
e.length*4;i+=3){c=(e[i>>2]>>8*(i%4)&255)<<16|(e[i+1>>2]>>8*((i+1)%4)&255)<<8|e[i+2>>2]>>8*((i+2)%4)&255;for(f=0;f<4;f++)h+=i*8+f*6>e.length*32?"":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>6*(3-f)&63)}return h},m=function(e,h,c,f,i,l){e=t(t(h,e),t(f,l));return t(e<<i|e>>>32-i,c)},q=function(e,h,c,f,i,l,u){return m(h&c|~h&f,e,h,i,l,u)},d=function(e,h,c,f,i,l,u){return m(h&f|c&~f,e,h,i,l,u)},a=function(e,h,c,f,i,l,u){return m(c^(h|~f),e,h,i,l,u)},b=function(e,h){e[h>>
5]|=128<<h%32;e[(h+64>>>9<<4)+14]=h;for(var c=1732584193,f=-271733879,i=-1732584194,l=271733878,u,y,x,A,r=0;r<e.length;r+=16){u=c;y=f;x=i;A=l;c=q(c,f,i,l,e[r+0],7,-680876936);l=q(l,c,f,i,e[r+1],12,-389564586);i=q(i,l,c,f,e[r+2],17,606105819);f=q(f,i,l,c,e[r+3],22,-1044525330);c=q(c,f,i,l,e[r+4],7,-176418897);l=q(l,c,f,i,e[r+5],12,1200080426);i=q(i,l,c,f,e[r+6],17,-1473231341);f=q(f,i,l,c,e[r+7],22,-45705983);c=q(c,f,i,l,e[r+8],7,1770035416);l=q(l,c,f,i,e[r+9],12,-1958414417);i=q(i,l,c,f,e[r+10],17,
-42063);f=q(f,i,l,c,e[r+11],22,-1990404162);c=q(c,f,i,l,e[r+12],7,1804603682);l=q(l,c,f,i,e[r+13],12,-40341101);i=q(i,l,c,f,e[r+14],17,-1502002290);f=q(f,i,l,c,e[r+15],22,1236535329);c=d(c,f,i,l,e[r+1],5,-165796510);l=d(l,c,f,i,e[r+6],9,-1069501632);i=d(i,l,c,f,e[r+11],14,643717713);f=d(f,i,l,c,e[r+0],20,-373897302);c=d(c,f,i,l,e[r+5],5,-701558691);l=d(l,c,f,i,e[r+10],9,38016083);i=d(i,l,c,f,e[r+15],14,-660478335);f=d(f,i,l,c,e[r+4],20,-405537848);c=d(c,f,i,l,e[r+9],5,568446438);l=d(l,c,f,i,e[r+14],
9,-1019803690);i=d(i,l,c,f,e[r+3],14,-187363961);f=d(f,i,l,c,e[r+8],20,1163531501);c=d(c,f,i,l,e[r+13],5,-1444681467);l=d(l,c,f,i,e[r+2],9,-51403784);i=d(i,l,c,f,e[r+7],14,1735328473);f=d(f,i,l,c,e[r+12],20,-1926607734);c=m(f^i^l,c,f,e[r+5],4,-378558);l=m(c^f^i,l,c,e[r+8],11,-2022574463);i=m(l^c^f,i,l,e[r+11],16,1839030562);f=m(i^l^c,f,i,e[r+14],23,-35309556);c=m(f^i^l,c,f,e[r+1],4,-1530992060);l=m(c^f^i,l,c,e[r+4],11,1272893353);i=m(l^c^f,i,l,e[r+7],16,-155497632);f=m(i^l^c,f,i,e[r+10],23,-1094730640);
c=m(f^i^l,c,f,e[r+13],4,681279174);l=m(c^f^i,l,c,e[r+0],11,-358537222);i=m(l^c^f,i,l,e[r+3],16,-722521979);f=m(i^l^c,f,i,e[r+6],23,76029189);c=m(f^i^l,c,f,e[r+9],4,-640364487);l=m(c^f^i,l,c,e[r+12],11,-421815835);i=m(l^c^f,i,l,e[r+15],16,530742520);f=m(i^l^c,f,i,e[r+2],23,-995338651);c=a(c,f,i,l,e[r+0],6,-198630844);l=a(l,c,f,i,e[r+7],10,1126891415);i=a(i,l,c,f,e[r+14],15,-1416354905);f=a(f,i,l,c,e[r+5],21,-57434055);c=a(c,f,i,l,e[r+12],6,1700485571);l=a(l,c,f,i,e[r+3],10,-1894986606);i=a(i,l,c,f,
e[r+10],15,-1051523);f=a(f,i,l,c,e[r+1],21,-2054922799);c=a(c,f,i,l,e[r+8],6,1873313359);l=a(l,c,f,i,e[r+15],10,-30611744);i=a(i,l,c,f,e[r+6],15,-1560198380);f=a(f,i,l,c,e[r+13],21,1309151649);c=a(c,f,i,l,e[r+4],6,-145523070);l=a(l,c,f,i,e[r+11],10,-1120210379);i=a(i,l,c,f,e[r+2],15,718787259);f=a(f,i,l,c,e[r+9],21,-343485551);c=t(c,u);f=t(f,y);i=t(i,x);l=t(l,A)}return[c,f,i,l]},g=function(e,h){var c=v(e);if(c.length>16)c=b(c,e.length*8);for(var f=Array(16),i=Array(16),l=0;l<16;l++){f[l]=c[l]^909522486;
i[l]=c[l]^1549556828}c=b(f.concat(v(h)),512+h.length*8);return b(i.concat(c),640)};return{hexdigest:function(e){return j(b(v(e),e.length*8))},b64digest:function(e){return n(b(v(e),e.length*8))},hash:function(e){return p(b(v(e),e.length*8))},hmac_hexdigest:function(e,h){return j(g(e,h))},hmac_b64digest:function(e,h){return n(g(e,h))},hmac_hash:function(e,h){return p(g(e,h))},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"}}}();if(!Function.prototype.bind)Function.prototype.bind=function(t){var v=this,p=Array.prototype.slice,j=Array.prototype.concat,n=p.call(arguments,1);return function(){return v.apply(t?t:this,j.call(n,p.call(arguments,0)))}};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(t,v){var p=this.length,j=Number(v)||0;j=j<0?Math.ceil(j):Math.floor(j);if(j<0)j+=p;for(;j<p;j++)if(j in this&&this[j]===t)return j;return-1};
(function(t){function v(a,b){return new d.Builder(a,b)}function p(a){return new d.Builder("message",a)}function j(a){return new d.Builder("iq",a)}function n(a){return new d.Builder("presence",a)}var m;(function(){var a=capptain.Crypto,b=a.util,g=a.charenc.Binary;m={encode:function(e){return b.bytesToBase64(g.stringToBytes(e))},decode:function(e){return g.bytesToString(b.base64ToBytes(e))}}})();var q=capptain.MD5,d;d={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",
CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(a,
b){d.NS[a]=b},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(a,b,g){var e,h;for(e=0;e<a.childNodes.length;e++){h=a.childNodes[e];if(h.nodeType==d.ElementType.NORMAL&&(!b||this.isTagEqual(h,b)))g(h)}},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,
_makeGenerator:function(){var a;if(window.ActiveXObject){a=this._getIEXmlDom();a.appendChild(a.createElement("strophe"))}else a=document.implementation.createDocument("jabber:client","strophe",null);return a},xmlGenerator:function(){if(!d._xmlGenerator)d._xmlGenerator=d._makeGenerator();return d._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],
g=0;g<b.length;g++)if(a===null)try{a=new ActiveXObject(b[g])}catch(e){a=null}else break;return a},xmlElement:function(a){if(!a)return null;var b=d.xmlGenerator().createElement(a),g,e,h;for(g=1;g<arguments.length;g++)if(arguments[g])if(typeof arguments[g]=="string"||typeof arguments[g]=="number")b.appendChild(d.xmlTextNode(arguments[g]));else if(typeof arguments[g]=="object"&&typeof arguments[g].sort=="function")for(e=0;e<arguments[g].length;e++)typeof arguments[g][e]=="object"&&typeof arguments[g][e].sort==
"function"&&b.setAttribute(arguments[g][e][0],arguments[g][e][1]);else if(typeof arguments[g]=="object")for(h in arguments[g])arguments[g].hasOwnProperty(h)&&b.setAttribute(h,arguments[g][h]);return b},xmlescape:function(a){a=a.replace(/\&/g,"&amp;");a=a.replace(/</g,"&lt;");return a=a.replace(/>/g,"&gt;")},xmlTextNode:function(a){a=d.xmlescape(a);return d.xmlGenerator().createTextNode(a)},getText:function(a){if(!a)return null;var b="";if(a.childNodes.length===0&&(a.nodeType==d.ElementType.TEXT||
a.nodeType==d.ElementType.CDATA))b+=a.nodeValue;for(var g=0;g<a.childNodes.length;g++){var e=a.childNodes[g];if(e.nodeType==d.ElementType.TEXT||e.nodeType==d.ElementType.CDATA)b+=a.childNodes[g].nodeValue}return b},copyElement:function(a){var b,g;if(a.nodeType==d.ElementType.NORMAL){g=d.xmlElement(a.tagName);for(b=0;b<a.attributes.length;b++)g.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)g.appendChild(d.copyElement(a.childNodes[b]))}else if(a.nodeType==
d.ElementType.TEXT||a.nodeType==d.ElementType.CDATA)g=d.xmlTextNode(a.nodeValue);return g},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,
":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){if(a.indexOf("@")<0)return null;return a.split("@")[0]},getDomainFromJid:function(a){a=d.getBareJidFromJid(a);if(a.indexOf("@")<0)return a;else{a=a.split("@");a.splice(0,1);return a.join("@")}},getResourceFromJid:function(a){a=a.split("/");if(a.length<2)return null;a.splice(0,1);return a.join("/")},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,
a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;if(typeof a.tree==="function")a=a.tree();var g=a.nodeName,e,h;if(a.getAttribute("_realname"))g=a.getAttribute("_realname");b="<"+g;for(e=0;e<a.attributes.length;e++)if(a.attributes[e].nodeName!="_realname")b+=" "+a.attributes[e].nodeName+"='"+a.attributes[e].value.replace(/&/g,
"&amp;").replace(/\'/g,"&apos;").replace(/</g,"&lt;")+"'";if(a.childNodes.length>0){b+=">";for(e=0;e<a.childNodes.length;e++){h=a.childNodes[e];if(h.nodeType==d.ElementType.NORMAL)b+=d.serialize(h);else if(h.nodeType==d.ElementType.TEXT)b+=h.nodeValue;else if(h.nodeType==d.ElementType.CDATA)b+="<![CDATA["+h.nodeValue+"]]\>"}b+="</"+g+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){d._connectionPlugins[a]=b}};d.Builder=function(a,b){if(a=="presence"||
a=="message"||a=="iq")if(b&&!b.xmlns)b.xmlns=d.NS.CLIENT;else b||(b={xmlns:d.NS.CLIENT});this.node=this.nodeTree=d.xmlElement(a,b)};d.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return d.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b){var g=d.xmlElement(a,b);this.node.appendChild(g);this.node=g;return this},cnode:function(a){var b=
d.xmlGenerator(),g;try{g=b.importNode(a,true)}catch(e){g=d.copyElement(a)}this.node.appendChild(g);this.node=g;return this},t:function(a){this.node.appendChild(d.xmlTextNode(a));return this}};d.Handler=function(a,b,g,e,h,c,f){this.handler=a;this.ns=b;this.name=g;this.type=e;this.id=h;this.options=f||{matchbare:false};if(!this.options.matchBare)this.options.matchBare=false;this.from=this.options.matchBare?c?d.getBareJidFromJid(c):null:c;this.user=true};d.Handler.prototype={isMatch:function(a){var b,
g=null;g=this.options.matchBare?d.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from");b=false;if(this.ns){var e=this;d.forEachChild(a,null,function(h){if(h.getAttribute("xmlns")==e.ns)b=true});b=b||a.getAttribute("xmlns")==this.ns}else b=true;if(b&&(!this.name||d.isTagEqual(a,this.name))&&(!this.type||a.getAttribute("type")==this.type)&&(!this.id||a.getAttribute("id")==this.id)&&(!this.from||g==this.from))return true;return false},run:function(a){var b=null;try{b=this.handler(a)}catch(g){if(g.sourceURL)d.fatal("error: "+
this.handler+" "+g.sourceURL+":"+g.line+" - "+g.name+": "+g.message);else if(g.fileName){if(typeof console!="undefined"){console.trace();console.error(this.handler," - error - ",g,g.message)}d.fatal("error: "+this.handler+" "+g.fileName+":"+g.lineNumber+" - "+g.name+": "+g.message)}else d.fatal("error: "+this.handler);throw g;}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};d.TimedHandler=function(a,b){this.period=a;this.handler=b;this.lastCalled=
(new Date).getTime();this.user=true};d.TimedHandler.prototype={run:function(){this.lastCalled=(new Date).getTime();return this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};d.Request=function(a,b,g,e){this.id=++d._requestId;this.xmlData=a;this.data=d.serialize(a);this.func=this.origFunc=b;this.rid=g;this.date=NaN;this.sends=e||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date)return 0;
return(new Date-this.date)/1E3};this.timeDead=function(){if(!this.dead)return 0;return(new Date-this.dead)/1E3};this.xhr=this._newXHR()};d.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){a=this.xhr.responseXML.documentElement;if(a.tagName=="parsererror"){d.error("invalid response received");d.error("responseText: "+this.xhr.responseText);d.error("responseXML: "+d.serialize(this.xhr.responseXML));throw"parsererror";}}else if(this.xhr.responseText){d.error("invalid response received");
d.error("responseText: "+this.xhr.responseText);d.error("responseXML: "+d.serialize(this.xhr.responseXML))}return a},_newXHR:function(){var a=null;if(window.XDomainRequest){a=new XDomainRequest;a.readyState=0}else if(window.XMLHttpRequest){a=new XMLHttpRequest;a.overrideMimeType&&a.overrideMimeType("text/xml")}else if(window.ActiveXObject)a=new ActiveXObject("Microsoft.XMLHTTP");if(window.XDomainRequest){var b=this.func.bind(null,this);a.onload=function(){a.readyState=4;a.status=200;a.responseXML=
new ActiveXObject("Microsoft.XMLDOM");a.responseXML.async="false";a.responseXML.loadXML(a.responseText);b()};a.onerror=function(){d.error("XDR error");a.readyState=4;a.status=400;b()};a.ontimeout=function(){d.error("XDR timeout");a.readyState=4;a.status=400;b()}}else a.onreadystatechange=this.func.bind(null,this);return a}};d.Connection=function(a){this.service=a;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.features=this.streamId=this.sid=null;this.do_bind=this.do_session=false;
this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._disconnectTimeout=this._idleTimeout=null;this.connected=this.disconnecting=this.authenticated=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*1E4);this._sasl_challenge_handler=this._sasl_failure_handler=this._sasl_success_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),
100);for(var b in d._connectionPlugins)if(d._connectionPlugins.hasOwnProperty(b)){a=function(){};a.prototype=d._connectionPlugins[b];this[b]=new a;this[b].init(this)}};d.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.streamId=this.sid=null;this.do_bind=this.do_session=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.connected=this.disconnecting=this.authenticated=false;this.errors=
0;this._requests=[];this._uniqueId=Math.round(Math.random()*1E4)},pause:function(){this.paused=true},resume:function(){this.paused=false},getUniqueId:function(a){return typeof a=="string"||typeof a=="number"?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,g,e,h){this.jid=a;this.pass=b;this.connect_callback=g;this.authenticated=this.connected=this.disconnecting=false;this.errors=0;this.wait=e||this.wait;this.hold=h||this.hold;this.domain=d.getDomainFromJid(this.jid);a=this._buildBody().attrs({to:this.domain,
"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":d.NS.BOSH});this._changeConnectStatus(d.Status.CONNECTING,null);this._requests.push(new d.Request(a.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),a.tree().getAttribute("rid")));this._throttledRequestHandler()},attach:function(a,b,g,e,h,c,f){this.jid=a;this.sid=b;this.rid=g;this.connect_callback=e;this.domain=d.getDomainFromJid(this.jid);this.connected=
this.authenticated=true;this.wait=h||this.wait;this.hold=c||this.hold;this.window=f||this.window;this._changeConnectStatus(d.Status.ATTACHED,null)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(a!==null){if(typeof a.sort==="function")for(var b=0;b<a.length;b++)this._queueData(a[b]);else typeof a.tree==="function"?this._queueData(a.tree()):this._queueData(a);this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=
setTimeout(this._onIdle.bind(this),100)}},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(a,b,g,e){var h=null,c=this;if(typeof a.tree==="function")a=a.tree();var f=a.getAttribute("id");if(!f){f=this.getUniqueId("sendIQ");a.setAttribute("id",f)}var i=this.addHandler(function(l){h&&c.deleteTimedHandler(h);var u=l.getAttribute("type");if(u=="result")b&&b(l);else if(u=="error")g&&g(l);else throw{name:"StropheError",message:"Got bad IQ type of "+u};},null,"iq",null,f);
if(e)h=this.addTimedHandler(e,function(){c.deleteHandler(i);g&&g(null);return false});this.send(a);return f},_queueData:function(a){if(a===null||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var g=new d.TimedHandler(a,b);this.addTimeds.push(g);
return g},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,g,e,h,c,f){a=new d.Handler(a,b,g,e,h,c,f);this.addHandlers.push(a);return a},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(d.Status.DISCONNECTING,a);d.info("Disconnect was called because: "+a);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(a,
b){for(var g in d._connectionPlugins)if(d._connectionPlugins.hasOwnProperty(g)){var e=this[g];if(e.statusChanged)try{e.statusChanged(a,b)}catch(h){d.error(""+g+" plugin caused an exception changing status: "+h)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(c){d.error("User connection callback caused an exception: "+c)}},_buildBody:function(){var a=v("body",{rid:this.rid++,xmlns:d.NS.HTTPBIND});this.sid!==null&&a.attrs({sid:this.sid});return a},_removeRequest:function(a){d.debug("removing request");
var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];if(b.dead===null)b.dead=new Date;this._processRequest(a)},_processRequest:function(a){var b=this._requests[a],g=-1;try{if(b.xhr.readyState==4)g=b.xhr.status}catch(e){d.error("caught an error in _requests["+a+"], reqStatus: "+g)}if(typeof g=="undefined")g=-1;if(b.sends>5)this._onDisconnectTimeout();
else{var h=b.age();h=!isNaN(h)&&h>Math.floor(d.TIMEOUT*this.wait);var c=b.dead!==null&&b.timeDead()>Math.floor(d.SECONDARY_TIMEOUT*this.wait);g=b.xhr.readyState==4&&(g<1||g>=500);if(h||c||g){c&&d.error("Request "+this._requests[a].id+" timed out (secondary), restarting");b.abort=true;b.xhr.abort();b.xhr.onreadystatechange=function(){};this._requests[a]=new d.Request(b.xmlData,b.origFunc,b.rid,b.sends);b=this._requests[a]}if(b.xhr.readyState===0){d.debug("request id "+b.id+"."+b.sends+" posting");
b.date=new Date;try{b.xhr.open("POST",this.service,true)}catch(f){d.error("XHR open failed.");this.connected||this._changeConnectStatus(d.Status.CONNFAIL,"bad-service");this.disconnect();return}a=function(){b.xhr.send(b.data)};b.sends>1?setTimeout(a,Math.pow(b.sends,3)*1E3):a();b.sends++;this.xmlOutput(b.xmlData);this.rawOutput(b.data)}else d.debug("_processRequest: "+(a===0?"first":"second")+" request has readyState of "+b.xhr.readyState)}},_throttledRequestHandler:function(){this._requests?d.debug("_throttledRequestHandler called with "+
this._requests.length+" requests"):d.debug("_throttledRequestHandler called with undefined requests");if(!(!this._requests||this._requests.length===0)){this._requests.length>0&&this._processRequest(0);this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1)}},_onRequestStateChange:function(a,b){d.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState);if(b.abort)b.abort=false;else{var g;if(b.xhr.readyState==4){g=0;try{g=
b.xhr.status}catch(e){}if(typeof g=="undefined")g=0;if(this.disconnecting)if(g>=400){this._hitError(g);return}var h=this._requests[0]==b,c=this._requests[1]==b;if(g>0&&g<500||b.sends>5){this._removeRequest(b);d.debug("request id "+b.id+" should now be removed")}if(g==200){if(c||h&&this._requests.length>0&&this._requests[0].age()>Math.floor(d.SECONDARY_TIMEOUT*this.wait))this._restartRequest(0);d.debug("request id "+b.id+"."+b.sends+" got 200");a(b);this.errors=0}else{d.error("request id "+b.id+"."+
b.sends+" error "+g+" happened");if(g===0||g>=400&&g<600||g>=12E3){this._hitError(g);if(g>=400&&g<500){this._changeConnectStatus(d.Status.DISCONNECTING,null);this._doDisconnect()}}}g>0&&g<500||b.sends>5||this._throttledRequestHandler()}}},_hitError:function(a){this.errors++;d.warn("request errored, status: "+a+", number of errors: "+this.errors);this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){d.info("_doDisconnect was called");this.disconnecting=this.authenticated=false;this.streamId=
this.sid=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(d.Status.DISCONNECTED,null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},_dataRecv:function(a){try{var b=a.getResponse()}catch(g){if(g!="parsererror")throw g;this.disconnect("strophe-parsererror")}if(b!==null){this.xmlInput(b);for(this.rawInput(d.serialize(b));this.removeHandlers.length>0;){a=this.removeHandlers.pop();
a=this.handlers.indexOf(a);a>=0&&this.handlers.splice(a,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect()}else{a=b.getAttribute("type");if(a!==null&&a=="terminate"){if(!this.disconnecting){a=b.getAttribute("condition");b=b.getElementsByTagName("conflict");if(a!==null){if(a=="remote-stream-error"&&b.length>0)a="conflict";this._changeConnectStatus(d.Status.CONNFAIL,
a)}else this._changeConnectStatus(d.Status.CONNFAIL,"unknown");this.disconnect()}}else{var e=this;d.forEachChild(b,null,function(h){var c,f;f=e.handlers;e.handlers=[];for(c=0;c<f.length;c++){var i=f[c];if(i.isMatch(h)&&(e.authenticated||!i.user))i.run(h)&&e.handlers.push(i);else e.handlers.push(i)}})}}}},_sendTerminate:function(){d.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});this.authenticated&&a.c("presence",{xmlns:d.NS.CLIENT,type:"unavailable"});this.disconnecting=
true;this._requests.push(new d.Request(a.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),a.tree().getAttribute("rid")));this._throttledRequestHandler()},_connect_cb:function(a){d.info("_connect_cb was called");this.connected=true;if(a=a.getResponse()){this.xmlInput(a);this.rawInput(d.serialize(a));var b=a.getAttribute("type");if(b!==null&&b=="terminate"){b=a.getAttribute("condition");a=a.getElementsByTagName("conflict");if(b!==null){if(b=="remote-stream-error"&&a.length>0)b=
"conflict";this._changeConnectStatus(d.Status.CONNFAIL,b)}else this._changeConnectStatus(d.Status.CONNFAIL,"unknown")}else{if(!this.sid)this.sid=a.getAttribute("sid");if(!this.stream_id)this.stream_id=a.getAttribute("authid");if(b=a.getAttribute("requests"))this.window=parseInt(b,10);if(b=a.getAttribute("hold"))this.hold=parseInt(b,10);if(b=a.getAttribute("wait"))this.wait=parseInt(b,10);var g=b=false,e=false;a=a.getElementsByTagName("mechanism");var h,c;if(a.length>0){for(h=0;h<a.length;h++){c=d.getText(a[h]);
if(c=="DIGEST-MD5")g=true;else if(c=="PLAIN")b=true;else if(c=="ANONYMOUS")e=true}if(d.getNodeFromJid(this.jid)===null&&e){this._changeConnectStatus(d.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(v("auth",{xmlns:d.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else if(d.getNodeFromJid(this.jid)===null){this._changeConnectStatus(d.Status.CONNFAIL,
"x-strophe-bad-non-anon-jid");this.disconnect()}else if(g){this._changeConnectStatus(d.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);a=d.getNodeFromJid(this.jid);b=capptain.Crypto.HMAC(capptain.Crypto.SHA1,a,"d9f32df8743fe9489a8ccc1b57b9be4be4935ac2");this.send(j({type:"set",id:"register"}).c("query",
{xmlns:"jabber:iq:register"}).c("username",a).up().c("password",b).tree());this.send(v("auth",{xmlns:d.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else if(b){a=d.getBareJidFromJid(this.jid);a+="\u0000";a+=d.getNodeFromJid(this.jid);a+="\u0000";a+=this.pass;this._changeConnectStatus(d.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,
"failure",null,null);a=m.encode(a);this.send(v("auth",{xmlns:d.NS.SASL,mechanism:"PLAIN"}).t(a).tree())}else{this._changeConnectStatus(d.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send(j({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).tree())}}else{a=this._buildBody();this._requests.push(new d.Request(a.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),
a.tree().getAttribute("rid")));this._throttledRequestHandler()}}}},_sasl_challenge1_cb:function(a){var b=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,g=m.decode(d.getText(a));a=q.hexdigest(Math.random()*1234567890);var e="",h=null,c="",f;for(this.deleteHandler(this._sasl_failure_handler);g.match(b);){f=g.match(b);g=g.replace(f[0],"");f[2]=f[2].replace(/^"(.+)"$/,"$1");switch(f[1]){case "realm":e=f[2];break;case "nonce":c=f[2];break;case "host":h=f[2]}}b="xmpp/"+this.domain;if(h!==null)b=b+"/"+h;h=q.hash(d.getNodeFromJid(this.jid)+
":"+e+":"+this.pass)+":"+c+":"+a;g="AUTHENTICATE:"+b;f="";f+="username="+this._quote(d.getNodeFromJid(this.jid))+",";f+="realm="+this._quote(e)+",";f+="nonce="+this._quote(c)+",";f+="cnonce="+this._quote(a)+",";f+='nc="00000001",';f+='qop="auth",';f+="digest-uri="+this._quote(b)+",";f+="response="+this._quote(q.hexdigest(q.hexdigest(h)+":"+c+":00000001:"+a+":auth:"+q.hexdigest(g)))+",";f+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",
null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(v("response",{xmlns:d.NS.SASL}).t(m.encode(f)).tree());return false},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);
this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send(v("response",{xmlns:d.NS.SASL}).tree());return false},_auth1_cb:function(){var a=j({type:"set",id:"_auth_2"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!d.getResourceFromJid(this.jid))this.jid=d.getBareJidFromJid(this.jid)+
"/strophe";a.up().c("resource",{}).t(d.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(a.tree());return false},_sasl_success_cb:function(){d.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",
null,null);this._sendRestart();return false},_sasl_auth1_cb:function(a){this.features=a;var b,g;for(b=0;b<a.childNodes.length;b++){g=a.childNodes[b];if(g.nodeName=="bind")this.do_bind=true;if(g.nodeName=="session")this.do_session=true}if(this.do_bind){this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");(a=d.getResourceFromJid(this.jid))?this.send(j({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:d.NS.BIND}).c("resource",{}).t(a).tree()):this.send(j({type:"set",id:"_bind_auth_2"}).c("bind",
{xmlns:d.NS.BIND}).tree())}else this._changeConnectStatus(d.Status.AUTHFAIL,null);return false},_sasl_bind_cb:function(a){if(a.getAttribute("type")=="error"){d.info("SASL binding failed.");this._changeConnectStatus(d.Status.AUTHFAIL,null);return false}a=a.getElementsByTagName("bind");if(a.length>0){a=a[0].getElementsByTagName("jid");if(a.length>0){this.jid=d.getText(a[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send(j({type:"set",
id:"_session_auth_2"}).c("session",{xmlns:d.NS.SESSION}).tree())}else{this.authenticated=true;this._changeConnectStatus(d.Status.CONNECTED,null)}}}else{d.info("SASL binding failed.");this._changeConnectStatus(d.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(d.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){d.info("Session creation failed.");this._changeConnectStatus(d.Status.AUTHFAIL,
null)}return false},_sasl_failure_cb:function(){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._changeConnectStatus(d.Status.AUTHFAIL,null);return false},_auth2_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(d.Status.CONNECTED,null)}else if(a.getAttribute("type")==
"error"){this._changeConnectStatus(d.Status.AUTHFAIL,null);this.disconnect()}return false},_addSysTimedHandler:function(a,b){var g=new d.TimedHandler(a,b);g.user=false;this.addTimeds.push(g);return g},_addSysHandler:function(a,b,g,e,h){a=new d.Handler(a,b,g,e,h);a.user=false;this.addHandlers.push(a);return a},_onDisconnectTimeout:function(){d.info("_onDisconnectTimeout was called");for(var a;this._requests.length>0;){a=this._requests.pop();a.abort=true;a.xhr.abort();a.xhr.onreadystatechange=function(){}}this._doDisconnect();
return false},_onIdle:function(){for(var a,b,g,e;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){b=this.removeTimeds.pop();a=this.timedHandlers.indexOf(b);a>=0&&this.timedHandlers.splice(a,1)}var h=(new Date).getTime();e=[];for(a=0;a<this.timedHandlers.length;a++){b=this.timedHandlers[a];if(this.authenticated||!b.user){g=b.lastCalled+b.period;if(g-h<=0)b.run()&&e.push(b);else e.push(b)}}this.timedHandlers=e;if(this.authenticated&&this._requests.length===
0&&this._data.length===0&&!this.disconnecting){d.info("no requests during idle cycle, sending blank request");this._data.push(null)}if(this._requests.length<2&&this._data.length>0&&!this.paused){b=this._buildBody();for(a=0;a<this._data.length;a++)if(this._data[a]!==null)this._data[a]==="restart"?b.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":d.NS.BOSH}):b.cnode(this._data[a]).up();delete this._data;this._data=[];this._requests.push(new d.Request(b.tree(),this._onRequestStateChange.bind(this,
this._dataRecv.bind(this)),b.tree().getAttribute("rid")));this._processRequest(this._requests.length-1)}if(this._requests.length>0){a=this._requests[0].age();this._requests[0].dead!==null&&this._requests[0].timeDead()>Math.floor(d.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler();if(a>Math.floor(d.TIMEOUT*this.wait)){d.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(d.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler()}}clearTimeout(this._idleTimeout);
this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};t&&t(d,v,p,j,n)})(function(t,v,p,j,n){capptain.Strophe=t;capptain.$build=v;capptain.$msg=p;capptain.$iq=j;capptain.$pres=n});var JSON;JSON||(JSON={});
(function(){function t(b){return b<10?"0"+b:b}function v(b){n.lastIndex=0;return n.test(b)?'"'+b.replace(n,function(g){var e=d[g];return typeof e==="string"?e:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function p(b,g){var e,h,c,f,i=m,l,u=g[b];if(u&&typeof u==="object"&&typeof u.toJSON==="function")u=u.toJSON(b);if(typeof a==="function")u=a.call(g,b,u);switch(typeof u){case "string":return v(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);case "object":if(!u)return"null";
m+=q;l=[];if(Object.prototype.toString.apply(u)==="[object Array]"){f=u.length;for(e=0;e<f;e+=1)l[e]=p(e,u)||"null";c=l.length===0?"[]":m?"[\n"+m+l.join(",\n"+m)+"\n"+i+"]":"["+l.join(",")+"]";m=i;return c}if(a&&typeof a==="object"){f=a.length;for(e=0;e<f;e+=1)if(typeof a[e]==="string"){h=a[e];if(c=p(h,u))l.push(v(h)+(m?": ":":")+c)}}else for(h in u)if(Object.prototype.hasOwnProperty.call(u,h))if(c=p(h,u))l.push(v(h)+(m?": ":":")+c);c=l.length===0?"{}":m?"{\n"+m+l.join(",\n"+m)+"\n"+i+"}":"{"+l.join(",")+
"}";m=i;return c}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var j=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m,q,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a;if(typeof JSON.stringify!=="function")JSON.stringify=function(b,g,e){var h;q=m="";if(typeof e==="number")for(h=0;h<e;h+=1)q+=" ";else if(typeof e==="string")q=e;if((a=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return p("",
{"":b})};if(typeof JSON.parse!=="function")JSON.parse=function(b,g){function e(c,f){var i,l,u=c[f];if(u&&typeof u==="object")for(i in u)if(Object.prototype.hasOwnProperty.call(u,i)){l=e(u,i);if(l!==undefined)u[i]=l;else delete u[i]}return g.call(c,f,u)}var h;b=String(b);j.lastIndex=0;if(j.test(b))b=b.replace(j,function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){h=eval("("+b+")");return typeof g==="function"?e({"":h},""):h}throw new SyntaxError("JSON.parse");}})();if(!capptain.appId)throw Error("capptain.appId must be set");if(typeof capptain.sessionTimeout!="number")capptain.sessionTimeout=1E4;capptain.packageName=capptain.packageName||capptain.appId;capptain.serviceVersion="0.7.0";capptain.domain=capptain.domain||"api.prod.capptain.com";
capptain.utils=function(){var t="0123456789abcdef".split(""),v=function(j){return j<10?"0"+j:j},p={printCurrentTime:function(){var j=new Date;return v(j.getHours())+":"+v(j.getMinutes())+":"+v(j.getSeconds())},trim:String.trim||function(j){return j.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},uuid:function(){var j=[],n,m;j[12]="4";for(m=0;m<32;m++)if(!j[m]){n=0|Math.random()*16;j[m]=t[m==16?n&3|8:n]}return j.join("")},getTag:function(j,n){var m=j.getElementsByTagName(n);if(m.length)return m[0]},getText:function(j){if(j=
capptain.Strophe.getText(j))return p.trim(j)},getTagText:function(j,n){return p.getText(p.getTag(j,n))},getDateFromHours:function(j){var n=new Date;n.setTime(n.getTime()+j*36E5);return n},getCookie:function(j){j+="=";var n=document.cookie.split(";"),m;for(m=0;m<n.length;m++){for(var q=n[m];q.charAt(0)==" ";)q=q.substring(1,q.length);if(q.indexOf(j)==0)return q.substring(j.length,q.length)}return null},setCookie:function(j,n,m){m=m?"; expires="+p.getDateFromHours(m).toGMTString():"";document.cookie=
j+"="+n+m+"; path=/"},deleteCookie:function(j){p.setCookie(j,"",-1)},ajax:function(j,n,m,q,d){var a;if(window.XDomainRequest){a=new XDomainRequest;a.onload=function(){p.logAjaxResult(n,a);m(a);p.destroyAjax(a)};a.onerror=function(){q(a);p.destroyAjax(a)}}else{a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4){p.logAjaxResult(n,a);a.status==200?m(a):q(a);p.destroyAjax(a)}}}capptain.debug&&capptain.console.log("SEND: "+j,n);a.open(j,n,true);a.withCredentials=true;try{a.send()}catch(b){d(b)}},
destroyAjax:function(j){try{j.destroy()}catch(n){}},logAjaxResult:function(j,n){capptain.debug&&capptain.console.log("RECV:",j,n.responseText)},getQueryParameter:function(j){var n=window.location.search.substring(1).split("&"),m;for(m=0;m<n.length;m++){var q=n[m].split("=");if(q[0]==j)return q[1]}}};return p}();
capptain.storage=capptain.storage||function(){var t=capptain.utils,v;return v=window.localStorage?{set:function(p,j,n){if(n=="session"){sessionStorage[p]=JSON.stringify(j);localStorage.removeItem(p)}else{localStorage[p]=JSON.stringify({ttl:n?t.getDateFromHours(n).getTime():undefined,val:j});sessionStorage.removeItem(p)}},get:function(p){try{var j=sessionStorage[p];if(j)return JSON.parse(j);else{j=localStorage[p];j=JSON.parse(j);if((new Date).getTime()>j.ttl){v.del(p);return null}else return j.val}}catch(n){return null}},
del:function(p){sessionStorage.removeItem(p);localStorage.removeItem(p)}}:{get:t.getCookie,set:function(p,j,n){if(n){if(n=="session")n=null}else n=876E4;t.setCookie(p,j,n)},del:t.deleteCookie}}();
capptain.console=capptain.console||function(){if(window.console){var t=navigator.userAgent.search("Android")>-1,v=t||navigator.userAgent.search("iPhone")>-1,p=Array.prototype.slice,j=function(n,m){t||(m=[capptain.utils.printCurrentTime()].concat(m));if(!n.apply||v){var q=m.join(" ");n.call?n.call(console,q):n(q)}else n.apply(console,m)};return{log:function(){j(console.log,p.apply(arguments))},error:function(){j(console.error,p.apply(arguments))},warn:function(){j(console.warn,p.apply(arguments))},
info:function(){j(console.info,p.apply(arguments))}}}else return{log:function(){},error:function(){},warn:function(){},info:function(){}}}();
capptain.debug&&function(){var t=capptain.console;if(typeof capptain.stropheLogLevel!="number")capptain.stropheLogLevel=3;capptain.Strophe.Connection.prototype.rawInput=function(v){t.log("RECV:",v)};capptain.Strophe.Connection.prototype.rawOutput=function(v){t.log("SEND:",v)};capptain.Strophe.log=function(v,p){if(v>=capptain.stropheLogLevel)switch(v){case 0:t.log("Strophe:",p);break;case 1:t.info("Strophe:",p);break;case 2:t.warn("Strophe:",p);break;case 3:case 4:t.error("Strophe:",p)}}}();
capptain.userAgent=function(){var t=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"iPad",identity:"iPad"},{string:navigator.platform,subString:"iPod",identity:"iPod"},{string:navigator.platform,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.platform,
subString:"SHADOW",identity:"Samsung TV"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],v,p=function(n){var m;for(m=0;m<n.length;m++){var q=n[m].string,d=n[m].prop;v=n[m].versionSearch||n[m].identity;if(q){if(q.indexOf(n[m].subString)!=-1)return n[m].identity}else if(d)return n[m].identity}},j=function(n){var m=n.indexOf(v);if(m!=-1)return parseFloat(n.substring(m+v.length+1))};return{browser:p([{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,
subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.appName,subString:"Maple",identity:"Maple"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},
{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Android",identity:"WebKit",versionSearch:"Version"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]),version:j(navigator.userAgent)||
j(navigator.appVersion),platform:p(t)}}();
capptain.agent=function(){var t=capptain.console,v=capptain.utils,p=capptain.storage,j=v.trim,n=v.uuid,m=v.getTag,q=v.getTagText,d=capptain.Strophe,a=capptain.$build,b=capptain.$pres,g=capptain.$iq,e=capptain.$msg,h=capptain.MD5.hexdigest,c,f=false,i,l,u={},y={};y.prev=y;y.next=y;var x=0,A={},r,C=[],F=0,D,G="capptain."+capptain.appId+".sid",z=p.get(G),N=null,J={},K,L,R=function(){if(!capptain.deviceId){var k=p.get("capptain.deviceId");k||(k=h(n()));p.set("capptain.deviceId",k);capptain.deviceId=k}k=
capptain.deviceId;var o=capptain.appId,s="capptain."+o+".register";if(p.get(s)!=k){var w=v.getQueryParameter("capptain.referrer");if(w)try{JSON.parse(unescape(w))}catch(O){t.error("Invalid Capptain Referrer (must be JSON)");w=null}o="http://"+capptain.domain+"/track/1/register?deviceid="+k+"&appid="+o;if(w)o+="&extras="+w;v.ajax("POST",o,function(){t.info("Register OK.");p.set(s,k)},function(){t.error("Cannot register.")},S)}if(w=p.get("capptain.connection"))try{w=JSON.parse(w)}catch(ca){}if(w)if(capptain.Strophe.getNodeFromJid(w.jid)==
capptain.deviceId&&w.apiDomain==capptain.domain){r=w.epoch;T(capptain.Strophe.getNodeFromJid(w.jid),{domain:capptain.Strophe.getDomainFromJid(w.jid),serviceDomain:w.serviceDomain})}else p.del("capptain.connection");w=capptain.userAgent;w={serviceVersion:capptain.serviceVersion,locale:navigator.language||navigator.browserLanguage,firmwareName:w.browser,firmwareVersion:w.version,phoneModel:w.platform,timeZoneOffset:-(new Date).getTimezoneOffset()};if(capptain.appVersionName)w.applicationVersionName=
capptain.appVersionName;if(capptain.appVersionCode)w.applicationVersionCode=capptain.appVersionCode;w=JSON.stringify(w);D=h(w);o="capptain."+capptain.appId+".infoid";D!=p.get(o)&&B(a("info",{id:n(),infoid:D}).t(w));p.set(o,D,24);R=null},M=function(k,o){if(k)if(k.constructor===Array){var s;for(s=0;s<k.length;s++)try{var w=k[s];w.apply(w,o)}catch(O){t.error(O)}}else t.error(k+" must be wrapped in an array.")},U=function(k){k.prev=y.prev;k.next=y;y.prev.next=k;y.prev=k},W=function(k,o){var s=u[k];if(s){s.prev.next=
s.next;s.next.prev=s.prev;U(s);o(s.data)}else if(A[k])A[k].push(o);else{A[k]=[o];V(k)}},V=function(k){v.ajax("GET","http://"+capptain.domain+"/xmpp-disco?deviceID="+k,function(o){o=JSON.parse(o.responseText);T(k,o);var s=A[k],w;for(w=0;w<s.length;w++)s[w](o);delete A[k]},function(){t.error("XMPP disco failed, retrying in 5s");setTimeout(function(){V(k)},5E3)},S)},S=function(k){t.error("Fatal error:",JSON.stringify(k));B=function(){};C=[];F=0},T=function(k,o){var s={data:o,deviceId:k};u[k]=s;U(s);
if(x==10){s=y.next;s.prev.next=s.next;s.next.prev=s.prev;delete u[s.deviceId]}else x++},X=function(k){c=new d.Connection(k);c.addHandler(aa,"urn:ubikod:ermin:push:0","message",null,null,l);c.addHandler(ba,"urn:ubikod:ermin:0","message")},Z=function(k){switch(k){case d.Status.ATTACHED:c.send(e({to:c.domain}));setTimeout(function(){c.send(e({to:c.domain}));setTimeout(function(){f=true;P();M(capptain.onConnected,[])},105)},105);break;case d.Status.CONNECTED:f=true;c.send(b());c.sendIQ(g({to:i,type:"set"}).c("epoch",
{xmlns:"urn:ubikod:ermin:0"}),function(){r=(new Date).getTime();P()},function(){t.error("Epoch error")});Y();M(capptain.onConnected,[]);break;case d.Status.DISCONNECTED:p.del("capptain.connection");f=false;r=null;M(capptain.onDisconnected,[]);Q.connect()}},Y=function(){c.sendIQ(g({type:"get",to:l}).c("messages",{xmlns:"urn:ubikod:ermin:push:0",appid:capptain.appId}),function(k){(k=m(k,"messages"))&&d.forEachChild(k,"message",function(o){var s=o.getAttribute("id"),w=q(o,"payload");o=o.getAttribute("replyto");
M(capptain.onPushMessageReceived,[s,w,o])})})},aa=function(k){(k=m(k,"tickle"))&&k.getAttribute("appid")==capptain.appId&&Y();return true},ba=function(k){if(k.getAttribute("type")!="error"){var o=m(k,"deviceMessage");if(o){if(k=k.getAttribute("from"))k=d.getNodeFromJid(k);if(o.getAttribute("packageName")==capptain.packageName){o=v.getText(o);c.send(e({to:c.domain}));M(capptain.onDeviceMessageReceived,[k,o])}}}return true},P=function(){if(r&&f&&F==0&&C.length>0){var k=g({to:i,type:"set"}).c("log",
{xmlns:"urn:ubikod:ermin:0",appid:capptain.appId});F=C.length;var o;for(o=0;o<F;o++){C[o].log.attrs({toffset:C[o].timestamp-r});k.cnode(C[o].log.tree()).up()}c.sendIQ(k,function(){C=C.slice(F);F=0;P()},function(){F=0;t.error("Log error")})}},B=function(k){C.push({log:k,timestamp:(new Date).getTime()});P()},E=function(k){k=j(k);if(k.length)return k;else throw Error("Empty string not allowed.");},H=function(k){if(k){k=JSON.stringify(k);if(k[0]!="{")throw Error("extras must be a non null object (and not an array)");
return k}},I=function(k,o){o&&k.c("x").t(o).up()},$=function(){var k=a("endSession",{sid:z});L&&k.attrs({locid:L});B(k);K=N=z=null;p.del(G)},Q={connect:function(){R&&R();W(capptain.deviceId,function(k){i="logger."+k.domain;l="push."+k.serviceDomain;var o="http://bosh."+k.domain+"/http-bind";try{var s=p.get("capptain.connection");if(!s)throw undefined;s=JSON.parse(s);p.del("capptain.connection");X(o);c.attach(s.jid,s.sid,s.rid-1,Z)}catch(w){w&&t.warn("Resume connection failed ",w);p.del("capptain.connection");
X(o);o=capptain.Crypto.HMAC(capptain.Crypto.SHA1,capptain.deviceId,"accf24cc95da85fee44418125ea16091dad29939");c.connect(capptain.deviceId+"@"+k.domain,o,Z)}})},pause:function(){if(f&&!window.XDomainRequest){c.pause();p.set("capptain.connection",JSON.stringify({jid:c.jid,sid:c.sid,rid:c.rid,epoch:r,apiDomain:capptain.domain,serviceDomain:u[capptain.deviceId].data.serviceDomain}),1/60/2)}},sendMessageToDevice:function(k,o,s){W(k,function(w){if(f){s=s||capptain.packageName;var O;O=s.indexOf(".")==-1?
"":"/"+s;c.send(e({to:k+"@"+w.domain+O,id:n()}).c("deviceMessage",{xmlns:"urn:ubikod:ermin:0",packageName:s}).t(o).tree())}})},startActivity:function(k,o){if(k)k=E(k);o=H(o);if(z){if(K){clearTimeout(K);K=null}}else{z=n();B(a("startSession",{sid:z,infoid:D}))}p.set(G,z,0.5);N=k?k:"default";M(capptain.onActivityChanged,[N]);var s=a("activity",{id:n(),sid:z});k&&s.attrs({name:k});I(s,o);B(s)},endActivity:function(){if(K)throw Error("Activity already ended (session is idle)");else if(z)if(capptain.sessionTimeout>
0){N="idle";B(a("idle",{id:n(),sid:z}));K=setTimeout($,capptain.sessionTimeout)}else $();else throw Error("Cannot end activity, no activity started.");},getActivity:function(){return N},startJob:function(k,o){k=E(k);o=H(o);if(J[k])throw Error('Job "'+k+'" already started');var s=n();J[k]=s;s=a("startJob",{infoid:D,jobid:s,name:k});I(s,o);B(s)},endJob:function(k){k=E(k);if(J[k]){var o=J[k];delete J[k];k=a("endJob",{jobid:o});L&&k.attrs({locid:L});B(k)}else throw Error('Cannot end job "'+k+'" : not started.');
},sendEvent:function(k,o){k=E(k);o=H(o);var s=a("event",{id:n(),name:k,infoid:D});I(s,o);B(s)},sendSessionEvent:function(k,o){k=E(k);o=H(o);if(!z)throw Error("Cannot send session event: session not started.");var s=a("event",{id:n(),name:k,sid:z});I(s,o);B(s)},sendJobEvent:function(k,o,s){k=E(k);o=E(o);s=H(s);var w=J[o];if(!w)throw Error('Cannot send job event, no job: "'+o+'"');k=a("event",{id:n(),name:k,jobid:w});I(k,s);B(k)},sendError:function(k,o){k=E(k);o=H(o);var s=a("error",{id:n(),name:k,
infoid:D});I(s,o);B(s)},sendSessionError:function(k,o){k=E(k);o=H(o);if(!z)throw Error("Cannot send session error: session not started.");var s=a("error",{id:n(),name:k,sid:z});I(s,o);B(s)},sendJobError:function(k,o,s){k=E(k);o=E(o);s=H(s);var w=J[o];if(!w)throw Error('Cannot send job error, no job: "'+o+'"');k=a("error",{id:n(),name:k,jobid:w});I(k,s);B(k)},sendCrash:function(k,o){var s=h(E(k));o=E(o);s=a("crash",{id:n(),crashid:s,infoid:D}).t(o);z&&s.attrs({sid:z});B(s)},sendLocation:function(k){var o=
a("geoloc",{xmlns:"http://jabber.org/protocol/geoloc"});typeof k.country=="string"&&o.c("country").t(k.country).up();typeof k.latitude=="number"&&o.c("lat").t(""+k.latitude).up();typeof k.locality=="string"&&o.c("locality").t(k.locality).up();typeof k.longitude=="number"&&o.c("lon").t(""+k.longitude).up();typeof k.region=="string"&&o.c("region").t(k.region).up();o=o.tree();L=h(d.serialize(o));B(a("location",{id:n(),infoid:D,locid:L}).cnode(o).up())},sendAppInfo:function(k){B(a("appInfo").t(JSON.stringify(k)))},
_send:function(k){f&&c.send(k)}};z&&Q.endActivity();capptain.disableAutoConnect||Q.connect();return Q}();if(!capptain.reach)capptain.reach={};
(function(){var t=capptain.console,v=capptain.storage,p=capptain.utils.getText,j=capptain.utils.getTagText,n="capptain."+capptain.appId+".reach",m=v.get(n)||[],q,d,a=function(h){var c,f=function(l){if(!c&&q==h){if(h.replyto){var u=capptain.$msg({to:h.replyto}).c(h.kind,{xmlns:"urn:ubikod:ermin:reach:0",id:h.id});u.cnode(l);capptain.agent._send(u.tree())}m.splice(d,1);v.set(n,m);c=true;q=null;g()}};h.cancel=function(){f(capptain.$build("cancelled").tree())};switch(h.kind){case "announcement":h.acknowledge=function(){f(capptain.$build("ok").tree())};
break;case "poll":var i={};h.fillAnswer=function(l,u){i[l]=u};h.submitAnswers=function(){var l=capptain.$build("ok"),u;for(u in i)l.c("question",{id:u}).c("choice",{id:i[u]}).up().up();f(l.tree())}}},b=function(h){if(!q){var c=capptain.agent.getActivity();return c?typeof h.behavior=="string"||h.behavior.indexOf(c)>-1:h.behavior=="any"}},g=function(){var h;for(h=0;h<m.length;h++){var c=m[h];if(b(c)&&e(c)){d=h;break}}},e=function(h){q=h;a(h);try{capptain.reach.onContentReceived(h);return true}catch(c){t.error("capptain.reach.onContentReceived failed:",
c);q=null;return false}};capptain.onPushMessageReceived=capptain.onPushMessageReceived||[];capptain.onPushMessageReceived.push(function(h,c,f){if(window.DOMParser){parser=new DOMParser;h=parser.parseFromString(c,"text/xml")}else{h=new ActiveXObject("Microsoft.XMLDOM");h.async="false";h.loadXML(c)}c=h.documentElement;if(!(!c||c.getAttribute("xmlns")!="urn:ubikod:ermin:reach:0")){f={id:c.getAttribute("id"),kind:c.nodeName,replyto:f,notification:{},behavior:"any",exit:{},action:{}};switch(f.kind){case "announcement":f.type=
c.getAttribute("type");f.category=c.getAttribute("category");break;case "poll":f.questions=[]}c=c.childNodes;for(h=0;h<c.length;h++){var i=c[h];switch(i.nodeName){case "title":f.title=p(i);break;case "body":f.body=p(i);break;case "notification":var l=f.notification;l.title=j(i,"title");l.message=j(i,"message");break;case "action":l=f.action;l.label=j(i,"label");if(f.kind=="announcement")l.url=j(i,"url");break;case "exit":f.exit.label=j(i,"label");break;case "behavior":if(i.getElementsByTagName("session").length)f.behavior=
"session";else{l=i.getElementsByTagName("activity");if(l.length){var u=[];for(i=0;i<l.length;i++)u[i]=p(l[i]);f.behavior=u}}break;case "question":l=[];u={id:i.getAttribute("id"),title:j(i,"title"),choices:l};var y=i.getElementsByTagName("choice");for(i=0;i<y.length;i++){var x=y[i];l[i]={id:x.getAttribute("id"),title:p(x),"default":x.getAttribute("default")=="true"}}f.questions.push(u)}}m.push(f);v.set(n,m);if(b(f)){d=m.length-1;e(f)}}});capptain.onActivityChanged=capptain.onActivityChanged||[];capptain.onActivityChanged.push(g);
if(typeof capptain.reach.onContentReceived!="function")capptain.reach.onContentReceived=function(h){var c=document.getElementById("capptain_notification_area");document.getElementById("capptain_notification_title").innerHTML=h.notification.title;document.getElementById("capptain_notification_message").innerHTML=h.notification.message;document.getElementById("capptain_notification_close").onclick=function(f){c.style.visibility="hidden";f=f||window.event;if(f.stopPropagation)f.stopPropagation();else f.cancelBubble=
true;h.cancel()};c.onclick=function(){c.style.visibility="hidden";try{capptain.reach.onContentClicked(h)}catch(f){t.error("capptain.reach.onContentClicked failed:",f);processContent=null}};c.style.visibility="visible"};if(typeof capptain.reach.onContentClicked!="function")capptain.reach.onContentClicked=function(h){var c=document.getElementById("capptain_overlay"),f=document.getElementById("capptain_overlay_title"),i=document.getElementById("capptain_overlay_body"),l=document.getElementById("capptain_overlay_action"),
u=document.getElementById("capptain_overlay_exit"),y=document.getElementById("capptain_overlay_poll");f.innerHTML=h.title;i.innerHTML=h.body;l.innerHTML=h.action.label||"OK";u.innerHTML=h.exit.label||"Cancel";l.onclick=function(){c.style.visibility="hidden";if(h.kind=="announcement")h.acknowledge();else{var D=y.getElementsByTagName("input"),G;for(G=0;G<D.length;G++){var z=D[G];z.checked&&h.fillAnswer(z.questionId,z.choiceId)}h.submitAnswers()}h.action.url&&setTimeout(function(){location=h.action.url},
500)};for(u.onclick=function(){c.style.visibility="hidden";h.cancel()};y.firstChild;)y.removeChild(y.firstChild);if(h.kind=="poll"){f=h.questions;for(i=0;i<f.length;i++){l=f[i];u=document.createElement("fieldset");var x=document.createElement("legend");x.innerHTML=l.title;u.appendChild(x);x=l.choices;var A;for(A=0;A<x.length;A++){var r=x[A],C=document.createElement("input");C.setAttribute("type","radio");C.setAttribute("name","capptain_overlay_poll_question_"+l.id);r["default"]&&C.setAttribute("checked",
true);C.questionId=l.id;C.choiceId=r.id;var F=document.createElement("label");F.innerHTML=r.title;u.appendChild(C);u.appendChild(F);u.appendChild(document.createElement("br"))}y.appendChild(u)}}c.style.visibility="visible"}})();
